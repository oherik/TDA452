<!DOCTYPE html>
<!-- saved from url=(0100)http://www.cse.chalmers.se/edu/course/TDA452_Functional_Programming/lectures/TestDataGenerators.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width = device-width">
<title>Test Data Generators
</title>
<link rel="stylesheet" type="text/css" href="./Test Data Generators_files/tslides.css" title="Slides"><style type="text/css">
:root .mod > ._jH + .rscontainer
{ display: none !important; }</style></head>

<body class="all">
Page 1
<div class="page"><h1>Test Data Generators
</h1><h2><p class="center"><img style="max-width: 40%" src="./Test Data Generators_files/Two_red_dice_01.svg" alt=""></p></h2></div>
Page 2
<div class="page"><h1>Remember IO?
</h1><h2>Last time we looked at how IO works in Haskell
</h2>
<ul>
<li>Functions that perform IO operations have <div class="codequote"><div class="code"><pre><b class="tcon">IO</b></pre></div></div> in their return type:

<ul>
<li class="block"><div class="code"><pre><var class="var">putStr</var>    <b>::</b> <b class="tcon">String</b> <b>-&gt;</b> <b class="tcon">IO</b> ()
<var class="var">getLine</var>   <b>::</b> <b class="tcon">IO</b> <b class="tcon">String</b>
<var class="var">writeFile</var> <b>::</b> <b class="tcon">FilePath</b> <b>-&gt;</b> <b class="tcon">String</b> <b>-&gt;</b> <b class="tcon">IO</b> ()
<var class="var">readFile</var>  <b>::</b> <b class="tcon">FilePath</b> <b>-&gt;</b> <b class="tcon">IO</b> <b class="tcon">String</b></pre></div></li></ul>
</li><li>We can build larger IO functions using the <div class="codequote"><!--exp lex--><div class="code"><pre><b>do</b></pre></div></div>-notation:

<ul>
<li class="block"><div class="code"><pre><var class="var">copyFile</var> <b>::</b> <b class="tcon">FilePath</b> <b>-&gt;</b> <b class="tcon">FilePath</b> <b>-&gt;</b> <b class="tcon">IO</b> ()
<var class="var">copyFile</var> <var class="var">from</var> <var class="var">to</var> <b>=</b> <b>do</b> <var class="var">text</var> <b>&lt;-</b> <var class="var">readFile</var> <var class="var">from</var>
                      <var class="var">writeFile</var> <var class="var">to</var> <var class="var">text</var></pre></div></li></ul>
</li><li>We can not hide a call to an IO function inside a pure function.

</li><li>Pure functions have no side effects. Same argument ==&gt; same result.
</li></ul></div>
Page 3
<div class="page"><h1>Random testing with QuickCheck
</h1>
<ul>
<li class="block"><div class="code"><pre><var class="var">prop_example</var> <b>::</b> <b class="tcon">Integer</b> <b>-&gt;</b> <b class="tcon">Bool</b>
<var class="var">prop_example</var> <var class="var">n</var> <b>=</b> (<var class="var">n</var><var class="varop">+</var><span class="lit">3</span>)<var class="varop">^</var><span class="lit">2</span> <var class="varop">==</var> <var class="var">n</var><var class="varop">^</var><span class="lit">2</span> <var class="varop">+</var> <span class="lit">6</span><var class="varop">*</var><var class="var">n</var> <var class="varop">+</var> <span class="lit">9</span></pre></div>
</li><li class="block"><div class="code"><code class="Main">quickCheck prop_example</code>
+++ OK, passed 100 tests.
</div>

</li><li>QuickCheck generates 100 random integers. How is this done?
</li></ul></div>
Page 4
<div class="page"><h1>Test data generators
</h1>
<ul>
<li>QuickCheck uses a type <div class="codequote"><div class="code"><pre><b class="tcon">Gen</b> <var class="tvar">a</var></pre></div></div> for random test data generators and
provides an overloaded function with instances available for most
predefined types:

</li><li class="block"><div class="code"><pre><var class="var">arbitrary</var> <b>::</b> <b class="tcon">Arbitrary</b> <var class="tvar">a</var> <b>=&gt;</b> <b class="tcon">Gen</b> <var class="tvar">a</var></pre></div>
</li><li>There are also functions that let you
have a look at the random values generators produce:

</li><li class="block"><div class="code"><pre><var class="var">sample</var>   <b>::</b> <b class="tcon">Show</b> <var class="tvar">a</var> <b>=&gt;</b> <b class="tcon">Gen</b> <var class="tvar">a</var> <b>-&gt;</b> <b class="tcon">IO</b> ()
<var class="var">sample'</var>  <b>::</b> <b class="tcon">Gen</b> <var class="tvar">a</var> <b>-&gt;</b> <b class="tcon">IO</b> [<var class="tvar">a</var>]
<var class="var">generate</var> <b>::</b> <b class="tcon">Gen</b> <var class="tvar">a</var> <b>-&gt;</b> <b class="tcon">IO</b> <var class="tvar">a</var></pre></div></li></ul></div>
Page 5
<div class="page"><h1>Sampling test data
</h1>
<ul>
<li class="block"><div class="code"><code class="Main">sample' (arbitrary::Gen Integer)</code>
[0,2,-1,-6,2,4,4,-11,14,9,3]
<code class="Main">sample' (arbitrary::Gen Integer)</code>
[0,2,-2,-3,5,4,-9,-5,16,-13,-6]
</div>

</li><li>Same argument, but different results.
</li></ul></div>
Page 6
<div class="page"><h1>Sampling Bool
</h1>
<ul>
<li class="block"><div class="code"><code class="Main">sample' (arbitrary::Gen Bool)</code>
[True,False,True,False,False,True,True,False,False,True,True]
</div>

</li><li>Two tests would be enough...
</li></ul></div>
Page 7
<div class="page"><h1>Sampling Lists
</h1>
<ul>
<li class="block"><div class="code"><code class="Main">sample (arbitrary::Gen [Integer])</code>
[]
[2]
[-3]
[4]
[7,-2,-3,-8,5,8,-5]
[3,-4]
[-10,0,7,1,2,5,-12,-3,8,-7,10,11]
[-2,3,-5,-8,-3,-2,14,6,1,6,7,-2,-3,-12]
[15,-13,15,-11,-11,-6,13,16,7,-13,-8,-2,-13,13,3,-13]
[5,-15,5,13,12,1,-3,4,-13,-15,-7,18,-9,-18]
[-8,-20,-10,-4,6,5,-15]
</div>

</li><li>Short lists first, then longer lists.
</li></ul></div>
Page 8
<div class="page"><h1>Functions for creating generators
</h1>
<ul>
<li>From the QuickCheck library:

</li><li class="block"><div class="code"><pre><var class="var">elements</var>  <b>::</b> [<var class="tvar">a</var>] <b>-&gt;</b> <b class="tcon">Gen</b> <var class="tvar">a</var>
<var class="var">oneof</var>     <b>::</b> [<b class="tcon">Gen</b> <var class="tvar">a</var>] <b>-&gt;</b> <b class="tcon">Gen</b> <var class="tvar">a</var>
<var class="var">frequency</var> <b>::</b> [(<b class="tcon">Int</b>,<b class="tcon">Gen</b> <var class="tvar">a</var>)] <b>-&gt;</b> <b class="tcon">Gen</b> <var class="tvar">a</var>
<var class="var">listOf</var>    <b>::</b> <b class="tcon">Gen</b> <var class="tvar">a</var> <b>-&gt;</b> <b class="tcon">Gen</b> [<var class="tvar">a</var>]
<var class="var">vectorOf</var>  <b>::</b> <b class="tcon">Int</b> <b>-&gt;</b> <b class="tcon">Gen</b> <var class="tvar">a</var> <b>-&gt;</b> <b class="tcon">Gen</b> [<var class="tvar">a</var>]
<var class="var">choose</var>    <b>::</b> <b class="tcon">Random</b> <var class="tvar">a</var> <b>=&gt;</b> (<var class="tvar">a</var>,<var class="tvar">a</var>) <b>-&gt;</b> <b class="tcon">Gen</b> <var class="tvar">a</var></pre></div>
</li><li class="block"><div class="codequote"><div class="code"><pre><var class="var">choose</var></pre></div></div> uses functions from the module
<code><b class="mod">System.Random</b></code>.
</li></ul></div>
Page 9
<div class="page"><h1>Sampling generators
</h1>
<ul>
<li>Testing <div class="codequote"><div class="code"><pre><var class="var">choose</var></pre></div></div> and <div class="codequote"><div class="code"><pre><var class="var">listOf</var></pre></div></div>

</li><li class="block"><div class="code Main"><code>sample' (choose ('a','z'))</code>
"ozlikagbygw"
<code>sample' (listOf (choose ('a','z')))</code>
["","t","xviy","","hfpkft","","iiisswjvrkg","suoz","slfosefhofpgla","","l"]
</div>
</li></ul></div>
Page 10
<div class="page"><h1>Generating a Suit
</h1>
<ul>
<li>Remember the type <code><b class="tcon">Suit</b></code>?

<ul>
<li class="block"><div class="code"><pre><b>data</b> <b class="tcon">Suit</b> <b>=</b> <b class="con">Spades</b> <b>|</b> <b class="con">Hearts</b> <b>|</b> <b class="con">Diamonds</b> <b>|</b> <b class="con">Clubs</b>
          <b>deriving</b> (<b class="tcon">Eq</b>,<b class="tcon">Show</b>)
</pre></div></li></ul>
</li><li>The function <div class="codequote"><div class="code"><pre><var class="var">elements</var></pre></div></div> is perfect for generating random suits.

<ul>
<li class="block"><div class="code"><pre><var class="var">rSuit</var> <b>::</b> <b class="tcon">Gen</b> <b class="tcon">Suit</b>
<var class="var">rSuit</var> <b>=</b> <var class="var">elements</var> [<b class="con">Spades</b>,<b class="con">Hearts</b>,<b class="con">Diamonds</b>,<b class="con">Clubs</b>]
</pre></div></li></ul></li></ul></div>
Page 11
<div class="page"><h1>Generating a Rank
</h1><h2>Remember the type <code><b class="tcon">Rank</b></code>?
</h2>
<ul>
<li class="block"><div class="code"><pre><b>data</b> <b class="tcon">Rank</b> <b>=</b> <b class="con">Numeric</b> <b class="tcon">Integer</b> <b>|</b> <b class="con">Jack</b> <b>|</b> <b class="con">Queen</b> <b>|</b> <b class="con">King</b> <b>|</b> <b class="con">Ace</b>
            <b>deriving</b> (<b class="tcon">Eq</b>,<b class="tcon">Show</b>)
</pre></div>
</li><li>We could create a generator with <div class="codequote"><div class="code"><pre><var class="var">elements</var></pre></div></div> and a list of all ranks.
Here another way that gives us more flexibility:

</li><li class="block"><div class="code"><pre><var class="var">rNumeric</var> <b>::</b> <b class="tcon">Gen</b> <b class="tcon">Rank</b>
<var class="var">rNumeric</var> <b>=</b> <var class="var">elements</var> [<b class="con">Numeric</b> <var class="var">n</var><b>|</b><var class="var">n</var><b>&lt;-</b>[<span class="lit">2</span><b>..</b><span class="lit">10</span>]]

<var class="var">rFaceCard</var> <b>::</b> <b class="tcon">Gen</b> <b class="tcon">Rank</b>
<var class="var">rFaceCard</var> <b>=</b> <var class="var">elements</var> [<b class="con">Jack</b>,<b class="con">Queen</b>,<b class="con">King</b>,<b class="con">Ace</b>]

<var class="var">rRank_v1</var> <b>::</b> <b class="tcon">Gen</b> <b class="tcon">Rank</b>
<var class="var">rRank_v1</var> <b>=</b> <var class="var">oneof</var> [<var class="var">rNumeric</var>,<var class="var">rFaceCard</var>]

<var class="var">rRank</var> <b>::</b> <b class="tcon">Gen</b> <b class="tcon">Rank</b>
<var class="var">rRank</var> <b>=</b> <var class="var">frequency</var> [(<span class="lit">9</span>,<var class="var">rNumeric</var>),(<span class="lit">4</span>,<var class="var">rFaceCard</var>)]
</pre></div>
</li><li class="block"><div class="codequote"><div class="code"><pre><var class="var">rRank_v1</var></pre></div></div> and <div class="codequote"><div class="code"><pre><var class="var">rRank</var></pre></div></div> give different distributions...
</li></ul></div>
Page 12
<div class="page"><h1>Generating a Card?
</h1><h2>Remember the type <div class="codequote"><div class="code"><pre><b class="tcon">Card</b></pre></div></div>?
</h2>
<ul>
<li class="block"><div class="code"><pre><b>data</b> <b class="tcon">Card</b> <b>=</b> <b class="con">Card</b> <b class="tcon">Rank</b> <b class="tcon">Suit</b>
            <b>deriving</b> (<b class="tcon">Eq</b>,<b class="tcon">Show</b>)
</pre></div>
</li><li class="block"><div class="code"><pre><var class="var">rCard</var> <b>::</b> <b class="tcon">Gen</b> <b class="tcon">Card</b>
<var class="var">rCard</var> <b>=</b> (<var class="varop">??</var>)
</pre></div>
</li><li>Here we want to reuse <div class="codequote"><div class="code"><pre><var class="var">rSuit</var></pre></div></div> and <div class="codequote"><div class="code"><pre><var class="var">rRank</var></pre></div></div>. How can we do what?

</li><li>Are there some functions to combine generators in the QuickCheck
library?
</li></ul></div>
Page 13
<div class="page"><h1>Gen vs IO
</h1>
<ul>
<li>The type <div class="codequote"><div class="code"><pre><b class="tcon">Gen</b> <var class="tvar">a</var></pre></div></div> is for functions that generate random values of type <div class="codequote"><div class="code"><pre><var class="tvar">a</var></pre></div></div>.

</li><li>The type <div class="codequote"><div class="code"><pre><b class="tcon">IO</b> <var class="tvar">a</var></pre></div></div> is for functions that performs IO operations and return
values of type <div class="codequote"><div class="code"><pre><var class="tvar">a</var></pre></div></div>.

</li><li>But both are <em>monads</em> and
the <div class="codequote"><!--exp lex--><div class="code"><pre><b>do</b></pre></div></div>-notation can be used with any monad!

<ul>
<li>We can build larger generator functions from smaller ones in the
same way as we build larger IO functions from smaller ones.
</li></ul></li></ul></div>
Page 14
<div class="page"><h1>Generating a Card
</h1><div class="code"><pre><var class="var">rCard</var> <b>::</b> <b class="tcon">Gen</b> <b class="tcon">Card</b>
<var class="var">rCard</var> <b>=</b> <b>do</b> <var class="var">r</var> <b>&lt;-</b> <var class="var">rRank</var>
           <var class="var">s</var> <b>&lt;-</b> <var class="var">rSuit</var>
           <var class="var">return</var> (<b class="con">Card</b> <var class="var">r</var> <var class="var">s</var>)
</pre></div></div>
Page 15
<div class="page"><h1>More examples
</h1>
<ul>
<li>Other examples illustrating that <div class="codequote"><!--exp lex--><div class="code"><pre><b>do</b></pre></div></div> and <div class="codequote"><div class="code"><pre><var class="var">return</var></pre></div></div> can
be used with type <div class="codequote"><div class="code"><pre><b class="tcon">Gen</b> <var class="tvar">a</var></pre></div></div>, not just with type <div class="codequote"><div class="code"><pre><b class="tcon">IO</b> <var class="tvar">a</var></pre></div></div>.

</li><li class="block"><div class="code"><code class="Main">sample' (return 5::Gen Integer)</code>
[5,5,5,5,5,5,5,5,5,5,5]
</div>

</li><li>Remember <div class="codequote"><div class="code"><pre><var class="var">doTwice</var></pre></div></div>?

</li><li class="block"><div class="code"><code class="Main">sample' (doTwice (arbitrary::Gen Integer))</code>
[(0,0),(2,-1),(1,1),(6,1),(-4,-1),(4,0),
 (-1,7),(4,11),(10,8),(18,-5),(11,14)]
</div>
</li></ul></div>
Page 16
<div class="page"><h1>More examples 2
</h1>
<ul>
<li class="block"><div class="code"><pre><var class="var">evenInteger</var> <b>::</b> <b class="tcon">Gen</b> <b class="tcon">Integer</b>
<var class="var">evenInteger</var> <b>=</b> <b>do</b> <var class="var">n</var> <b>&lt;-</b> <var class="var">arbitrary</var>
                 <var class="var">return</var> (<span class="lit">2</span><var class="varop">*</var><var class="var">n</var>)

<var class="var">nonNegative</var> <b>::</b> <b class="tcon">Gen</b> <b class="tcon">Integer</b>
<var class="var">nonNegative</var> <b>=</b> <b>do</b> <var class="var">n</var> <b>&lt;-</b> <var class="var">arbitrary</var>
                 <var class="var">return</var> (<var class="var">abs</var> <var class="var">n</var>)
</pre></div>
</li><li class="block"><div class="code"><code class="Main">sample' evenInteger</code>
[0,2,-4,0,-2,6,-10,-22,22,-2,18]
<code class="Main">sample' nonNegative</code>
[0,1,0,3,2,0,1,9,8,2,20]
</div>
</li></ul></div>
Page 17
<div class="page"><h1>Generating a Hand
</h1><h2>Remember the type <code><b class="tcon">Hand</b></code>?
</h2>
<ul>
<li class="block"><div class="code"><pre><b>data</b> <b class="tcon">Hand</b> <b>=</b> <b class="con">Empty</b> <b>|</b> <b class="con">Add</b> <b class="tcon">Card</b> <b class="tcon">Hand</b>
            <b>deriving</b> (<b class="tcon">Eq</b>,<b class="tcon">Show</b>)
</pre></div>
</li><li class="block"><div class="code"><pre><var class="var">rHand</var> <b>::</b> <b class="tcon">Gen</b> <b class="tcon">Hand</b>
<var class="var">rHand</var> <b>=</b> <var class="var">oneof</var> [<var class="var">return</var> <b class="con">Empty</b>,
               <b>do</b> <var class="var">c</var> <b>&lt;-</b> <var class="var">rCard</var>
                  <var class="var">h</var> <b>&lt;-</b> <var class="var">rHand</var>
                  <var class="var">return</var> (<b class="con">Add</b> <var class="var">c</var> <var class="var">h</var>)]
</pre></div>
</li><li>Note: <div class="codequote"><div class="code"><pre><var class="var">rHand</var></pre></div></div> is recursive!

</li><li>Note: does it generate sensible hands?
</li></ul></div>
Page 18
<div class="page"><h1>Telling QuickCheck which generator to use
</h1>
<ul>
<li>The <div class="codequote"><div class="code"><pre><b class="tcon">Rank</b></pre></div></div> type contains values that are not valid ranks.

<ul>
<li class="block"><div class="code"><pre><var class="var">validRank</var> <b>::</b> <b class="tcon">Rank</b> <b>-&gt;</b> <b class="tcon">Bool</b>
<var class="var">validRank</var> (<b class="con">Numeric</b> <var class="var">n</var>) <b>=</b> <span class="lit">2</span><var class="varop">&lt;=</var><var class="var">n</var> <var class="varop">&amp;&amp;</var> <var class="var">n</var><var class="varop">&lt;=</var><span class="lit">10</span>
<var class="var">validRank</var> <b>_</b> <b>=</b> <b class="con">True</b></pre></div></li></ul>
</li><li>We can use <div class="codequote"><div class="code"><pre><var class="var">validRank</var></pre></div></div> to test that <div class="codequote"><div class="code"><pre><var class="var">rRank</var></pre></div></div> is correct!
</li></ul></div>
Page 19
<div class="page"><h5>Telling QuickCheck which generator to use
</h5><h2>Two ways to test if all generated cards are valid:
</h2>
<ul>
<li>Using the function <div class="codequote"><div class="code"><pre><var class="var">forAll</var></pre></div></div>:

</li><li class="block"><div class="code"><pre><var class="var">prop_all_validRank_1</var> <b>=</b> <var class="var">forAll</var> <var class="var">rRank</var> <var class="var">validRank</var></pre></div>
</li><li>Using <div class="codequote"><div class="code"><pre><var class="var">arbitrary</var></pre></div></div>:

</li><li class="block"><div class="code"><pre><b>instance</b> <b class="tcon">Arbitrary</b> <b class="tcon">Rank</b> <b>where</b>
  <var class="var">arbitrary</var> <b>=</b> <var class="var">rRank</var>

<var class="var">prop_all_validRank_2</var> <var class="var">r</var> <b>=</b> <var class="var">validRank</var> <var class="var">r</var></pre></div></li></ul></div>
Page 20
<div class="page"><h1>Arbitrary
</h1>
<ul>
<li class="block"><div class="code"><pre><b>class</b> <b class="tcon">Arbitrary</b> <b>where</b>
  <var class="var">arbitrary</var> <b>::</b> <b class="tcon">Gen</b> <var class="tvar">a</var>
  <var class="var">shrink</var> <b>::</b> <var class="tvar">a</var> <b>-&gt;</b> [<var class="tvar">a</var>]
</pre></div>
</li><li class="block"><div class="code"><pre><b>instance</b> <b class="tcon">Arbitrary</b> <b class="tcon">Bool</b>
<b>instance</b> <b class="tcon">Arbitrary</b> <b class="tcon">Int</b>
<b>instance</b> <b class="tcon">Arbitrary</b> <b class="tcon">Integer</b>
<span class="cmnt">-- many more instances...
</span></pre></div>
</li><li>It specificies a <em>default</em> test data generator for each type.

</li><li>It lets us test functions without specifying generators explicitly.

</li><li>The function <div class="codequote"><div class="code"><pre><var class="var">forAll</var></pre></div></div> lets us use other generators.
</li></ul></div>
Page 21
<div class="page"><h1>Test Data Distribution
</h1>
<ul>
<li>How do you know if a test has tested all the important cases?

</li><li class="block"><div class="code"><pre><var class="var">prop_all_validRank_3</var> <var class="var">r</var> <b>=</b> <var class="var">collect</var> <var class="var">r</var> (<var class="var">validRank</var> <var class="var">r</var>)
</pre></div>
</li><li class="block"><div class="code"><code class="Main">quickCheck prop_all_validRank_3</code>
+++ OK, passed 100 tests:
12% Numeric 10
11% Numeric 7
10% Ace
 9% Numeric 6
 9% Numeric 4
 9% King
 ...
 1% Jack
 </div>

</li><li>Using <div class="codequote"><div class="code"><pre><var class="var">collect</var> <var class="var">r</var></pre></div></div> doesn't change the test, but collects the values of
<div class="codequote"><div class="code"><pre><var class="var">r</var></pre></div></div> that were tested.
</li></ul></div>
Page 22
<div class="page"><h1>Distribution of Hands
</h1><div class="code"><pre><b>instance</b> <b class="tcon">Arbitrary</b> <b class="tcon">Hand</b> <b>where</b>
  <var class="var">arbitrary</var> <b>=</b> <var class="var">rHand</var>

<var class="var">size</var> <b class="con">Empty</b> <b>=</b> <span class="lit">0</span>
<var class="var">size</var> (<b class="con">Add</b> <var class="var">c</var> <var class="var">h</var>) <b>=</b> <span class="lit">1</span><var class="varop">+</var><var class="var">size</var> <var class="var">h</var>

<var class="var">prop_Hand</var> <var class="var">h</var> <b>=</b> <var class="var">collect</var> (<var class="var">size</var> <var class="var">h</var>) <b class="con">True</b></pre></div></div>
Page 23
<div class="page"><h5>Distribution of Hands
</h5>
<ul>
<li class="block"><div class="code"><code class="Main">quickCheck prop_Hand</code>
+++ OK, passed 100 tests:
47% 0
20% 1
13% 2
11% 3
 4% 4
 2% 5
 1% 7
 1% 6
 1% 12
</div>

</li><li>In general 50% empty hands and only 25% hands with more than one card.
</li></ul></div>
Page 24
<div class="page"><h1>More big Hands
</h1><h2>We can increase the probability that a non-empty hand is generated.
</h2><div class="code"><pre><var class="var">rHand</var> <b>::</b> <b class="tcon">Gen</b> <b class="tcon">Hand</b>
<var class="var">rHand</var> <b>=</b> <var class="var">frequency</var> [(<span class="lit">1</span>,<var class="var">return</var> <b class="con">Empty</b>),
                   (<span class="lit">4</span>,<b>do</b> <var class="var">c</var> <b>&lt;-</b> <var class="var">rCard</var>
                         <var class="var">h</var> <b>&lt;-</b> <var class="var">rHand</var>
                         <var class="var">return</var> (<b class="con">Add</b> <var class="var">c</var> <var class="var">h</var>))]
</pre></div></div>
Page 25
<div class="page"><h5>More big Hands
</h5>
<ul>
<li class="block"><div class="code"><code class="Main">quickCheck prop_Hand</code>
+++ OK, passed 100 tests:
19% 1
19% 0
13% 2
10% 4
 8% 6
 6% 3
 5% 9
 5% 5
 3% 7
...
</div>

</li><li>In general 20% empty hands, 16% with one card, ...
</li></ul></div>
Page 26
<div class="page"><h1>Testing properties of algorithms
</h1></div>
Page 27
<div class="page"><h1>Testing insert
</h1>
<ul>
<li>The function <div class="codequote"><div class="code"><pre><var class="var">insert</var></pre></div></div> inserts a value at the right place in an ordered list

</li><li class="block"><div class="code"><code class="Main">insert 'c' "abdef"</code>
"abcdef"
</div>

</li><li>The output list is ordered if the input list is ordered.

</li><li>How do we test it?
</li></ul></div>
Page 28
<div class="page"><h1>Testing insert, first try
</h1>
<ul>
<li class="block"><div class="code"><pre><var class="var">prop_insert_1</var> <b>::</b> <b class="tcon">Integer</b> <b>-&gt;</b> [<b class="tcon">Integer</b>] <b>-&gt;</b> <b class="tcon">Bool</b>
<var class="var">prop_insert_1</var> <var class="var">x</var> <var class="var">xs</var> <b>=</b> <var class="var">isOrdered</var> (<var class="var">insert</var> <var class="var">x</var> <var class="var">xs</var>)
</pre></div>
</li><li class="block"><div class="code"><code class="Main"> quickCheck prop_insert_1</code>
*** Failed! Falsifiable (after 3 tests and 4 shrinks):    
0
[0,-1]
</div>

</li><li>If the input list isn't ordered, the output list won't be ordered.
Bad test.
</li></ul></div>
Page 29
<div class="page"><h1>Testing insert, second try
</h1>
<ul>
<li class="block"><div class="code"><pre><var class="var">prop_insert_2</var> <b>::</b> <b class="tcon">Integer</b> <b>-&gt;</b> [<b class="tcon">Integer</b>] <b>-&gt;</b> <b class="tcon">Property</b>
<var class="var">prop_insert_2</var> <var class="var">x</var> <var class="var">xs</var> <b>=</b> <var class="var">isOrdered</var> <var class="var">xs</var> <var class="varop">==&gt;</var> <var class="var">isOrdered</var> (<var class="var">insert</var> <var class="var">x</var> <var class="var">xs</var>)
</pre></div>
</li><li class="block"><div class="code"><code class="Main"> quickCheck prop_insert_2</code>
*** Gave up! Passed only 68 tests.
</div>

</li><li>The probability that a random list is ordered is very low.
(Can we test this?)

</li><li>We need a test generator for ordered lists!
</li></ul></div>
Page 30
<div class="page"><h1>Testing ordered lists
</h1>
<ul>
<li>Fortunately, QuickCheck provides

</li><li class="block"><div class="code"><pre><var class="var">orderedList</var> <b>::</b> (<b class="tcon">Arbitrary</b> <var class="tvar">a</var>, <b class="tcon">Ord</b> <var class="tvar">a</var>) <b>=&gt;</b> <b class="tcon">Gen</b> [<var class="tvar">a</var>]
</pre></div>
</li><li>Two ways to use it

<ul>
<li class="block"><div class="code"><pre><var class="var">prop_insert_3</var> <var class="var">x</var> <b>=</b>
    <var class="var">forAll</var> <var class="var">orderedList</var> (<b>\</b><var class="var">xs</var><b>-&gt;</b><var class="var">isOrdered</var> (<var class="var">insert</var> <var class="var">x</var> <var class="var">xs</var>))
</pre></div>
</li><li class="block"><div class="code"><pre><var class="var">prop_insert_4</var> <var class="var">x</var> (<b class="con">Ordered</b> <var class="var">xs</var>) <b>=</b> <var class="var">isOrdered</var> (<var class="var">insert</var> <var class="var">x</var> <var class="var">xs</var>)
</pre></div></li></ul></li></ul></div>
Page 31
<div class="page"><h1>OrderedList
</h1>
<ul>
<li class="block"><div class="code"><pre><var class="var">prop_insert_4</var> <var class="var">x</var> (<b class="con">Ordered</b> <var class="var">xs</var>) <b>=</b> <var class="var">isOrdered</var> (<var class="var">insert</var> <var class="var">x</var> <var class="var">xs</var>)
</pre></div>
</li><li>This works, because QuickCheck also provides

<ul>
<li class="block"><div class="code"><pre><b>data</b> <b class="tcon">OrderedList</b> <var class="tvar">a</var> <b>=</b> <b class="con">Ordered</b> [<var class="tvar">a</var>]

<b>instance</b> (<b class="tcon">Ord</b> <var class="tvar">a</var>,<b class="tcon">Arbitrary</b> <var class="tvar">a</var>)
         <b>=&gt;</b> <b class="tcon">Arbitrary</b> (<b class="tcon">OrderedList</b> <var class="tvar">a</var>) <b>where</b>
  <var class="var">arbitrary</var> <b>=</b> <var class="var">orderedList</var></pre></div></li></ul>
</li><li>Exercise: how would you define <div class="codequote"><div class="code"><pre><var class="var">orderedList</var></pre></div></div>?
</li></ul></div>
Page 32
<div class="page"><h1>Summary
</h1>
<ul>
<li>We have seen how generate test data for QuickCheck.

<ul>
<li>For our own data types (Card, etc)

</li><li>How to deal with invariants (ordered lists)

</li><li>More info: <a href="http://hackage.haskell.org/package/QuickCheck-2.9.2/docs/Test-QuickCheck.html">QuickCheck documentation</a>
</li></ul>
</li><li>We have also seen that

<ul>
<li class="block"><div class="codequote"><div class="code"><pre><b class="tcon">IO</b></pre></div></div> and <div class="codequote"><div class="code"><pre><b class="tcon">Gen</b></pre></div></div> are two examples of <em>monads</em>.

</li><li>The <div class="codequote"><!--exp lex--><div class="code"><pre><b>do</b></pre></div></div>-notation can be used for both <div class="codequote"><div class="code"><pre><b class="tcon">IO</b></pre></div></div> and <div class="codequote"><div class="code"><pre><b class="tcon">Gen</b></pre></div></div> (and for
other monads).

</li><li>Later we will see other examples of monads and how to define your
own monads.
</li></ul></li></ul></div>
</body></html>
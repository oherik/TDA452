<!DOCTYPE html>
<!-- saved from url=(0093)http://www.cse.chalmers.se/edu/course/TDA452_Functional_Programming/lectures/InputOutput.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width = device-width">
<title>Programming IO
</title>
<link rel="stylesheet" type="text/css" href="./Programming IO_files/tslides.css" title="Slides"><style type="text/css">
:root .mod > ._jH + .rscontainer
{ display: none !important; }</style></head>

<body class="all">
Page 1
<div class="page"><h1>Programming IO
</h1><h2>Keeping pure and impure functions apart
</h2><h3><p class="center"><img style="max-width: 33%" src="./Programming IO_files/sideeffects.jpg"></p></h3></div>
Page 2
<div class="page"><h1>Remember the word counting function from last week?
</h1>
<ul>
<li class="block"><div class="code"><pre><var class="var">wordCounts</var> <b>::</b> <b class="tcon">String</b> <b>-&gt;</b> <b class="tcon">String</b></pre></div>
</li><li class="block"><div class="code"><code class="Main">putStr (wordCounts "hello clouds\nhello sky")</code>
clouds: 1
hello: 2
sky: 1
</div>

</li><li>What if we wanted to create a standalone program for counting words,
instead of just testing the function in GHCi?
</li></ul></div>
Page 3
<div class="page"><h1>Standalone Haskell programs
</h1>
<ul>
<li>The program should have a module called <code><b class="mod">Main</b></code>,
containing a function called <div class="codequote"><div class="code"><pre><var class="var">main</var></pre></div></div>:

<ul>
<li class="block"><div class="code"><pre><b>module</b> <b class="mod">Main</b> <b>where</b>

<var class="var">main</var> <b>::</b> <b class="tcon">IO</b> ()
<var class="var">main</var> <b>=</b> (<var class="varop">...</var>)
</pre></div></li></ul>
</li><li>The first line can be omitted, since the default module name is
<code><b class="mod">Main</b></code>.

</li><li>How do we create something of type <div class="codequote"><div class="code"><pre><b class="tcon">IO</b> ()</pre></div></div>?
</li></ul></div>
Page 4
<div class="page"><h1>Creating IO actions
</h1>
<ul>
<li>The type <div class="codequote"><div class="code"><pre><b class="tcon">IO</b> ()</pre></div></div> represents "IO actions".

</li><li>Here are some functions (some may be familiar already) that return
IO actions:

<ul>
<li class="block"><div class="code"><pre><var class="var">putStr</var>   <b>::</b> <b class="tcon">String</b> <b>-&gt;</b> <b class="tcon">IO</b> ()
<var class="var">print</var>    <b>::</b> <b class="tcon">Show</b> <var class="tvar">a</var> <b>=&gt;</b> <var class="tvar">a</var> <b>-&gt;</b> <b class="tcon">IO</b> ()
<var class="var">interact</var> <b>::</b> (<b class="tcon">String</b><b>-&gt;</b><b class="tcon">String</b>) <b>-&gt;</b> <b class="tcon">IO</b> ()
</pre></div></li></ul>
</li><li>Notice that the type of <div class="codequote"><div class="code"><pre><var class="var">interact</var></pre></div></div> fits nicely with our function
<div class="codequote"><div class="code"><pre><var class="var">wordCounts</var></pre></div></div>!
</li></ul></div>
Page 5
<div class="page"><h1>The program countWords
</h1>
<ul>
<li class="block"><div class="code"><pre><var class="var">main</var> <b>::</b> <b class="tcon">IO</b> ()
<var class="var">main</var> <b>=</b> <var class="var">interact</var> <var class="var">wordCounts</var>

<var class="var">wordCounts</var> <b>::</b> <b class="tcon">String</b> <b>-&gt;</b> <b class="tcon">String</b>
<var class="var">wordCounts</var> <b>=</b> (<var class="varop">...</var>) <span class="cmnt">-- as before
</span></pre></div>
</li><li>Compile it (assuming the file name is <code>countWords.hs</code>)

</li><li class="block"><div class="code"><code class="bash">ghc --make countWords.hs</code></div>

</li><li>Run it (taking input from a file <code>example.txt</code>):

<div class="code"><code class="bash">./countWords &lt;example.txt</code>
clouds: 1
hello: 2
sky: 1
</div>
</li></ul></div>
Page 6
<div class="page"><h1>Pure functions
</h1><h2>In Haskell, functions are pure
</h2>
<ul>
<li>When a function is applied, it computes and returns a result, but nothing
else happens. The are no <em>side effects</em>.

</li><li>As a consequence, same argument =&gt; same result. Consider

<ul>
<li class="block"><div class="code"><pre><var class="var">g1</var> <var class="var">x</var> <b>=</b> <var class="var">y</var> <var class="varop">+</var> <var class="var">y</var> <b>where</b> <var class="var">y</var> <b>=</b> <var class="var">f</var> <var class="var">x</var>

<var class="var">g2</var> <var class="var">x</var> <b>=</b> <var class="var">f</var> <var class="var">x</var> <var class="varop">+</var> <var class="var">f</var> <var class="var">x</var></pre></div></li></ul>
</li><li>g1 and g2 <em>always</em> compute the same result, regardless of
what f is.

<ul>
<li>g2 might be slower because of duplicated work.
</li></ul>
</li><li>Good for modularity!
Makes debugging and testing easier!

</li><li>Subexpressions can be computed in any order, even in parallel!
</li></ul></div>
Page 7
<div class="page"><h1>Equal and interchangeable
</h1>
<ul>
<li>In Haskell, an equation like <code>y = f x</code> means that we have
two <em>equal</em>, <em>interchangeable</em> things, like in math!

</li><li>Whether we refer to something by name or use it directly makes no
difference.

</li><li>You can use <em>equational reasoning</em>, like in math, to prove that
functions have desired properties.

<ul>
<li>Examples of things you could prove: 

<ul>
<li class="block"><div class="codequote"><div class="code"><pre><var class="var">map</var> <var class="var">g</var> <var class="varop">.</var> <var class="var">map</var> <var class="var">f</var> <var class="varop">==</var> <var class="var">map</var> (<var class="var">g</var><var class="varop">.</var><var class="var">f</var>)</pre></div></div>

</li><li class="block"><div class="codequote"><div class="code"><pre><var class="var">map</var> <var class="var">f</var> (<var class="var">xs</var><var class="varop">++</var><var class="var">ys</var>) <var class="varop">==</var> <var class="var">map</var> <var class="var">f</var> <var class="var">xs</var> <var class="varop">++</var> <var class="var">map</var> <var class="var">f</var> <var class="var">ys</var></pre></div></div>

</li><li class="block"><div class="codequote"><div class="code"><pre><var class="var">filter</var> <var class="var">p</var> (<var class="var">xs</var><var class="varop">++</var><var class="var">ys</var>) <var class="varop">==</var> <var class="var">filter</var> <var class="var">p</var> <var class="var">xs</var> <var class="varop">++</var> <var class="var">filter</var> <var class="var">p</var> <var class="var">ys</var></pre></div></div>

</li><li class="block"><div class="codequote"><div class="code"><pre><var class="var">map</var> <var class="var">f</var> <var class="varop">.</var> <var class="var">filter</var> <var class="var">p</var> <var class="varop">==</var> <var class="var">filter</var> (<var class="var">p</var> <var class="varop">.</var> <var class="var">f</var>) <var class="varop">.</var> <var class="var">map</var> <var class="var">f</var></pre></div></div>
</li></ul></li></ul></li></ul></div>
Page 8
<div class="page"><h1>An example in Python
</h1>
<ul>
<li class="block"><div class="code">&gt;&gt;&gt; <code>input() - input()</code>&nbsp;
<code>15</code>&nbsp;
<code>12</code>&nbsp;
3
&gt;&gt;&gt;
</div>

</li><li>The function <code>input</code> is not pure.

<ul>
<li>It interacts with the user.

</li><li>It can return different results even if the argument it the same.
</li></ul>
</li><li>We can tell from the result that the left operand was computed
before the right operand.
</li></ul></div>
Page 9
<div class="page"><h1>More IO in Haskell
</h1>
<ul>
<li>There is actually a function similar to Python's <code>input()</code>
in Haskell:

<ul>
<li class="block"><div class="code"><code class="Prelude">getLine</code>&nbsp;
<code>hello</code>
"hello"
</div>
</li></ul>
</li><li>And there is more:

</li><li class="block"><div class="code"><code class="Prelude">writeFile "hello.txt" "Hello world!"</code>&nbsp;
<code class="Prelude">readFile "hello.txt"</code>&nbsp;
"Hello world!"
</div>
But doesn't this break purity?
</li></ul></div>
Page 10
<div class="page"><h1>IO and purity in Haskell
</h1>
<ul>
<li>Let's look at the types of some "impure" functions again:

</li><li class="block"><div class="code"><pre><var class="var">putStr</var>    <b>::</b> <b class="tcon">String</b> <b>-&gt;</b> <b class="tcon">IO</b> ()
<var class="var">getLine</var>   <b>::</b> <b class="tcon">IO</b> <b class="tcon">String</b>
<var class="var">writeFile</var> <b>::</b> <b class="tcon">FilePath</b> <b>-&gt;</b> <b class="tcon">String</b> <b>-&gt;</b> <b class="tcon">IO</b> ()
<var class="var">readFile</var>  <b>::</b> <b class="tcon">FilePath</b> <b>-&gt;</b> <b class="tcon">IO</b> <b class="tcon">String</b>

<b>type</b> <b class="tcon">FilePath</b> <b>=</b> <b class="tcon">String</b></pre></div>
</li><li>The trick is the use of the type <div class="codequote"><div class="code"><pre><b class="tcon">IO</b></pre></div></div>.

<ul>
<li>All functions that interacts with the outside world in some way
has <div class="codequote"><div class="code"><pre><b class="tcon">IO</b></pre></div></div> in the result type.

</li><li>There is no way to "hide" a call to an "impure" function inside a pure
function.

</li><li>So how do we get access to the results from <code>getLine</code>
and <code>readFile</code>?
</li></ul></li></ul></div>
Page 11
<div class="page"><h1>Using IO results in GHCi
</h1>
<ul>
<li class="block"><div class="code"><code class="Prelude">s &lt;- readFile "hello.txt"</code>&nbsp;
<code class="Prelude">(s,reverse s)</code>&nbsp;
("Hello world!","!dlrow olleH")
</div>

</li><li>The left arrow <code>&lt;-</code> allows us to get the result of
an IO operation. Note the types

<ul>
<li class="block"><div class="codequote"><div class="code"><pre><var class="var">readFile</var> <span class="lit">"hello.txt"</span> <b>::</b> <b class="tcon">IO</b> <b class="tcon">String</b></pre></div></div>
<br><div class="codequote"><div class="code"><pre><var class="var">s</var> <b>::</b> <b class="tcon">String</b></pre></div></div>

</li><li>The types are different!

<ul>
<li>Haskell doesn't let you write
<code>s = </code><div class="codequote"><div class="code"><pre><var class="var">readFile</var> <span class="lit">"hello.txt"</span></pre></div></div> here, since it would
suggest that we have two equal, interchangeable things,
of the <em>same</em> type.
</li></ul></li></ul></li></ul></div>
Page 12
<div class="page"><h1>The do notation
</h1>
<ul>
<li>The <code>do</code> notation allows us to use
the left arrow <code>&lt;-</code> in the same way
inside function definitions.

</li><li class="block"><div class="code"><pre><var class="var">showTheDifference</var> <b>::</b> <b class="tcon">IO</b> ()
<var class="var">showTheDifference</var> <b>=</b> <b>do</b> <var class="var">putStrLn</var> <span class="lit">"Enter two numbers:"</span>
                       <var class="var">x</var> <b>&lt;-</b> <var class="var">readLn</var>
                       <var class="var">y</var> <b>&lt;-</b> <var class="var">readLn</var>
                       <var class="var">putStr</var> <span class="lit">"The difference is: "</span>
                       <var class="var">print</var> (<var class="var">x</var><var class="varop">-</var><var class="var">y</var>)
</pre></div>
</li><li>We used these functions:

</li><li class="block"><div class="code"><pre><var class="var">readLn</var>   <b>::</b> <b class="tcon">Read</b> <var class="tvar">a</var> <b>=&gt;</b> <b class="tcon">IO</b> <var class="tvar">a</var>
<var class="var">print</var>    <b>::</b> <b class="tcon">Show</b> <var class="tvar">a</var> <b>=&gt;</b> <var class="tvar">a</var> <b>-&gt;</b> <b class="tcon">IO</b> ()
<var class="var">putStr</var>   <b>::</b> <b class="tcon">String</b> <b>-&gt;</b> <b class="tcon">IO</b> ()
<var class="var">putStrLn</var> <b>::</b> <b class="tcon">String</b> <b>-&gt;</b> <b class="tcon">IO</b> ()
</pre></div></li></ul></div>
Page 13
<div class="page"><h1>Testing it
</h1><h2><div class="code"><code class="Main">showTheDifference</code>
Enter two numbers:
<code>15</code>&nbsp;
<code>12</code>&nbsp;
The difference is: 3
<code class="Main"> </code></div>
</h2></div>
Page 14
<div class="page"><h1>Doing IO and returning results
</h1>
<ul>
<li>What if we want a function that returns the difference instead of showing it?

</li><li class="block"><div class="code"><pre><var class="var">getTheDifference</var> <b>::</b> <b class="tcon">IO</b> <b class="tcon">Integer</b>
<var class="var">getTheDifference</var> <b>=</b> <b>do</b> <var class="var">x</var> <b>&lt;-</b> <var class="var">readLn</var>
                      <var class="var">y</var> <b>&lt;-</b> <var class="var">readLn</var>
                      <var class="var">return</var> (<var class="var">x</var><var class="varop">-</var><var class="var">y</var>)

<var class="var">showTheDifference</var> <b>::</b> <b class="tcon">IO</b> ()
<var class="var">showTheDifference</var> <b>=</b> <b>do</b> <var class="var">d</var> <b>&lt;-</b> <var class="var">getTheDifference</var>
                       <var class="var">putStr</var> <span class="lit">"The difference is: "</span>
                       <var class="var">print</var> <var class="var">d</var></pre></div>
</li><li>We need to use <code>return</code>:

</li><li class="block"><div class="code"><pre><var class="var">return</var> <b>::</b> <var class="tvar">a</var> <b>-&gt;</b> <b class="tcon">IO</b> <var class="tvar">a</var></pre></div></li></ul></div>
Page 15
<div class="page"><h1>The difference
</h1>
<ul>
<li>One key feature of Haskell is that it is a <em>purely</em> functional
language. Functions are <em>pure</em>.

</li><li>But Haskell still has "impure" functions for IO. The difference
from other languages is that pure and impure functions are kept apart,
by using the <div class="codequote"><div class="code"><pre><b class="tcon">IO</b></pre></div></div> type to mark "impure" functions.

</li><li>You can never hide the fact that IO is used somewhere
inside a large program.

<ul>
<li>You can get access to the result of an IO operation inside a <div class="codequote"><!--exp lex--><div class="code"><pre><b>do</b></pre></div></div> block,
then apply pure functions to it, but the whole <div class="codequote"><!--exp lex--><div class="code"><pre><b>do</b></pre></div></div> block has
type <div class="codequote"><div class="code"><pre><b class="tcon">IO</b></pre></div></div>.
</li></ul></li></ul></div>
Page 16
<div class="page"><h1>Why pure functions?
</h1><h2>Purity is good for modularity and simplifies debugging and testing.
</h2>
<ul>
<li>Unexpected side effects is a major source of bugs.

</li><li>Automated testing with QuickCheck is an example where it is
a good that functions are pure!

</li><li>Subexpressions can be computed in any order, even in parallel,
without changing the result of the program.
</li></ul></div>
Page 17
<div class="page"><h1>More examples 1
</h1><div class="code"><pre><var class="var">copyFile</var> <b>::</b> <b class="tcon">FilePath</b> <b>-&gt;</b> <b class="tcon">FilePath</b> <b>-&gt;</b> <b class="tcon">IO</b> ()
<var class="var">copyFile</var> <var class="var">from</var> <var class="var">to</var> <b>=</b> <b>do</b> <var class="var">s</var> <b>&lt;-</b> <var class="var">readFile</var> <var class="var">from</var>
                      <var class="var">writeFile</var> <var class="var">to</var> <var class="var">s</var></pre></div></div>
Page 18
<div class="page"><h1>More examples 2
</h1>
<ul>
<li class="block"><div class="code"><pre><var class="var">sortFile</var> <b>::</b> <b class="tcon">FilePath</b> <b>-&gt;</b> <b class="tcon">FilePath</b> <b>-&gt;</b> <b class="tcon">IO</b> ()
<var class="var">sortFile</var> <var class="var">from</var> <var class="var">to</var> <b>=</b> <b>do</b> <var class="var">s</var> <b>&lt;-</b> <var class="var">readFile</var> <var class="var">from</var>
                      <var class="var">writeFile</var> <var class="var">to</var> (<var class="var">sortLines</var> <var class="var">s</var>)

<var class="var">sortLines</var> <b>=</b> <var class="var">unlines</var> <var class="varop">.</var> <var class="var">sort</var> <var class="varop">.</var> <var class="var">lines</var></pre></div>
</li><li>You probably wouldn't want to do random testing of <code>sortFile</code>
(e.g. applying it to random file names 100 times)

</li><li>but it would make sense to test <code>sortLines</code> with QuickCheck.

</li><li>It's a good idea to keep most of the functions in a program pure and
and keep the IO functions as small and few as possible.
</li></ul></div>
Page 19
<div class="page"><h1>More examples 3
</h1>
<ul>
<li class="block"><div class="code"><pre><var class="var">doTwice</var> <b>::</b> <b class="tcon">IO</b> <var class="tvar">a</var> <b>-&gt;</b> <b class="tcon">IO</b> (<var class="tvar">a</var>,<var class="tvar">a</var>)
<var class="var">doTwice</var> <var class="var">io</var> <b>=</b> <b>do</b> <var class="var">x</var> <b>&lt;-</b> <var class="var">io</var>
                <var class="var">y</var> <b>&lt;-</b> <var class="var">io</var>
                <var class="var">return</var> (<var class="var">x</var>,<var class="var">y</var>)

<var class="var">don't</var> <b>::</b> <b class="tcon">IO</b> <var class="tvar">a</var> <b>-&gt;</b> <b class="tcon">IO</b> ()
<var class="var">don't</var> <var class="var">io</var> <b>=</b> <var class="var">return</var> ()
</pre></div>
</li><li>Try it in GHCi!
</li></ul></div>
Page 20
<div class="page"><h1>A larger example
</h1><h2>Hangman
</h2>
<ul>
<li>It's a simple word guessing game.

</li><li>See <a href="http://www.cse.chalmers.se/edu/course/TDA452_Functional_Programming/lectures/code/Hangman.hs">Hangman.hs</a>
</li></ul></div>
</body></html>